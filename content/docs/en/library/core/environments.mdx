---
title: Environments
description: Manage development and production environments effectively
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs'
import { Callout } from 'fumadocs-ui/components/callout'

# Environments

Commet SDK provides robust environment management with automatic detection, safe development modes, and flexible configuration for different deployment stages.

<Callout type="info">
**Safe by Default:** The SDK automatically prevents development data from affecting production billing.
</Callout>

## Environment Types

The SDK supports two primary environments:

### Development Environment

Safe environment for development and testing:

```typescript
// Automatically detected when NODE_ENV=development
const commet = new Commet({
  apiKey: 'ck_xxx1234567890abcdef',
  // Environment: 'development' (auto-detected)
  // Dev mode: Enabled (logs instead of API calls)
})

console.log(commet.getEnvironment()) // 'development'
console.log(commet.isDevelopment())  // true
```

### Production Environment

Live environment with real API calls:

```typescript
// Automatically detected when NODE_ENV=production
const commet = new Commet({
  apiKey: 'ck_xxx1234567890abcdef',
  // Environment: 'production' (auto-detected)
  // Dev mode: Disabled (real API calls)
})

console.log(commet.getEnvironment()) // 'production'
console.log(commet.isProduction())   // true
```

## Environment Detection

### Automatic Detection Rules

The SDK detects development environment when:

**Node.js Environment:**
- `process.env.NODE_ENV === 'development'`
- `process.env.NODE_ENV === 'test'`

**Browser Environment:**
- `hostname === 'localhost'`
- `hostname === '127.0.0.1'`
- `hostname.startsWith('192.168.')`
- `hostname.startsWith('10.')`
- `hostname.endsWith('.local')`

All other cases default to production.

### Manual Override

Override automatic detection when needed:

<Tabs items={['Explicit Environment', 'Auto Detection', 'Environment Check']}>
<Tab value="Explicit Environment">
```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'development', // Force development mode
  debug: true
})

// Always uses development behavior regardless of NODE_ENV
```
</Tab>
<Tab value="Auto Detection">
```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'auto' // Default behavior
})

// Uses automatic detection based on NODE_ENV and hostname
```
</Tab>
<Tab value="Environment Check">
```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!
})

console.log('Environment:', commet.getEnvironment())
console.log('Is Development:', commet.isDevelopment())
console.log('Is Production:', commet.isProduction())
```
</Tab>
</Tabs>

## Environment Configuration

### Environment Variables

Set up environment-specific configurations:

<Tabs items={['Development', 'Production', 'Multi-Environment']}>
<Tab value="Development">
```bash title=".env.local"
NODE_ENV=development
COMMET_API_KEY=ck_xxx1234567890abcdef
COMMET_DEBUG=true
```

```typescript title="lib/commet.ts"
import { Commet } from 'commet'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  debug: process.env.COMMET_DEBUG === 'true'
})
```
</Tab>
<Tab value="Production">
```bash title=".env.production"
NODE_ENV=production
COMMET_API_KEY=ck_xxx1234567890abcdef
```

```typescript title="lib/commet.ts"
export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  // debug: false (default in production)
})
```
</Tab>
<Tab value="Multi-Environment">
```typescript title="lib/commet.ts"
const getConfig = () => {
  const env = process.env.NODE_ENV
  
  switch (env) {
    case 'development':
      return {
        apiKey: process.env.COMMET_API_KEY!,
        debug: true,
        environment: 'development' as const
      }
    case 'production':
      return {
        apiKey: process.env.COMMET_API_KEY!,
        debug: false
      }
    default:
      throw new Error(`Unknown environment: ${env}`)
  }
}

export const commet = new Commet(getConfig())
```
</Tab>
</Tabs>

## Deployment Strategies

### Next.js Deployment

Configure for different deployment environments:

<Tabs items={['Development', 'Preview', 'Production']}>
<Tab value="Development">
```typescript title="lib/commet.ts"
import { Commet } from 'commet'

const isDev = process.env.NODE_ENV === 'development'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  debug: isDev,
  // Automatic dev mode in development
})
```
</Tab>
<Tab value="Preview">
```typescript title="lib/commet.ts"
// For Vercel Preview deployments
const isPreview = process.env.VERCEL_ENV === 'preview'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: isPreview ? 'development' : 'auto',
  debug: isPreview
})
```
</Tab>
<Tab value="Production">
```typescript title="lib/commet.ts"
// Production-ready configuration
export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  // Uses production mode automatically
  timeout: 30000,
  retries: 3
})
```
</Tab>
</Tabs>

## Environment-Specific Behavior

### Development Mode Features

When in development environment:

```typescript
// Logs events instead of sending API requests
await commet.usage.events.create({
  eventType: 'api_call',
  customerId: 'cus_dev_123'
})

// Console output:
// [Commet SDK] Dev mode
// Method: POST
// Endpoint: https://api.commet.co/api/usage/events
// Data: { eventType: 'api_call', customerId: 'cus_dev_123' }
// Request logged, not sent to server
```

### Production Mode Features

When in production environment:

```typescript
// Makes real API requests
const result = await commet.usage.events.create({
  eventType: 'api_call',
  customerId: 'cus_prod_456'
})

console.log('Event created:', result.data.id) // Real event ID
```

## Testing Across Environments

### Environment Testing

Test your environment configuration:

```typescript
const testEnvironment = () => {
  const commet = new Commet({
    apiKey: process.env.COMMET_API_KEY!,
    debug: true
  })
  
  console.log('Environment:', commet.getEnvironment())
  console.log('Is Development:', commet.isDevelopment())
  console.log('Is Production:', commet.isProduction())
  console.log('NODE_ENV:', process.env.NODE_ENV)
  
  return {
    environment: commet.getEnvironment(),
    nodeEnv: process.env.NODE_ENV
  }
}

// Run in different environments
console.log(testEnvironment())
```

## Best Practices

### Environment Separation

Keep environments completely separate:

```typescript
// ✅ Environment-specific configuration
const getCommetClient = () => {
  const env = process.env.NODE_ENV
  
  if (env === 'development') {
    return new Commet({
      apiKey: process.env.COMMET_API_KEY!,
      debug: true
    })
  } else if (env === 'production') {
    return new Commet({
      apiKey: process.env.COMMET_API_KEY!,
      timeout: 30000
    })
  }
  
  throw new Error(`Unknown environment: ${env}`)
}
```

### Configuration Validation

Validate configuration at startup:

```typescript
const validateConfig = () => {
  const requiredEnvVars = ['NODE_ENV', 'COMMET_API_KEY']
  
  for (const envVar of requiredEnvVars) {
    if (!process.env[envVar]) {
      throw new Error(`Missing required environment variable: ${envVar}`)
    }
  }
  
  const apiKey = process.env.COMMET_API_KEY!
  const isProduction = process.env.NODE_ENV === 'production'
  
  if (!apiKey.startsWith('ck_')) {
    console.warn('WARNING: Invalid API key format')
  }
}

// Run validation before initializing SDK
validateConfig()
export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!
})
```

### Deployment Checklist

Before deploying to production:

- [ ] Set `NODE_ENV=production`
- [ ] Use production API key
- [ ] Disable debug logging
- [ ] Configure appropriate timeouts and retries
- [ ] Validate all environment variables are set

```bash title="pre-deployment-check.sh"
#!/bin/bash

echo "Pre-deployment checklist..."

# Check NODE_ENV
if [ "$NODE_ENV" != "production" ]; then
  echo "❌ NODE_ENV is not set to production"
  exit 1
fi

# Check API key format
if [[ ! $COMMET_API_KEY =~ ^ck_ ]]; then
  echo "❌ COMMET_API_KEY should start with ck_"
  exit 1
fi

# Check required variables
for var in NODE_ENV COMMET_API_KEY; do
  if [ -z "${!var}" ]; then
    echo "❌ Missing required environment variable: $var"
    exit 1
  fi
done

echo "✅ Environment configuration validated"
```

## What's next?

<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  <div className="border rounded-lg p-4">
    <h3 className="font-semibold mt-0">Installation Guides</h3>
    <p className="text-sm text-muted-foreground">Framework-specific setup</p>
    <p className="text-sm">[Installation →](/library/installation/nextjs)</p>
  </div>
  
  <div className="border rounded-lg p-4">
    <h3 className="font-semibold mt-0">Usage Events</h3>
    <p className="text-sm text-muted-foreground">Start tracking usage across environments</p>
    <p className="text-sm">[Track usage →](/library/features/usage-events)</p>
  </div>
</div>
