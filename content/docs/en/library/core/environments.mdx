---
title: Environments
description: Manage sandbox and production environments effectively
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs'
import { Callout } from 'fumadocs-ui/components/callout'

# Environments

Commet SDK provides robust environment management with separate sandbox and production servers for safe testing and live billing operations.

<Callout type="info">
**Safe by Default:** Sandbox environment is used by default to prevent accidental changes to production data.
</Callout>

## Environment Types

The SDK supports two primary environments:

### Sandbox Environment (Default)

Safe environment for development and testing with real API calls to sandbox server:

```typescript
const commet = new Commet({
  apiKey: 'ck_xxx1234567890abcdef',
  environment: 'sandbox' // Default - uses sandbox.commet.co
})

console.log(commet.getEnvironment()) // 'sandbox'
console.log(commet.isSandbox())      // true
console.log(commet.isProduction())   // false
```

### Production Environment

Live environment for real billing operations:

```typescript
const commet = new Commet({
  apiKey: 'ck_xxx1234567890abcdef',
  environment: 'production' // Uses billing.commet.co
})

console.log(commet.getEnvironment()) // 'production'
console.log(commet.isSandbox())      // false
console.log(commet.isProduction())   // true
```

## Environment Configuration

### Explicit Configuration

Always specify your environment explicitly for clarity:

<Tabs items={['Sandbox', 'Production', 'Environment Check']}>
<Tab value="Sandbox">
```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox', // Explicit sandbox
  debug: true
})

// Uses sandbox.commet.co
```
</Tab>
<Tab value="Production">
```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'production' // Explicit production
})

// Uses billing.commet.co
```
</Tab>
<Tab value="Environment Check">
```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!
  // Defaults to 'sandbox' if not specified
})

console.log('Environment:', commet.getEnvironment())
console.log('Is Sandbox:', commet.isSandbox())
console.log('Is Production:', commet.isProduction())
```
</Tab>
</Tabs>

## Environment Configuration

### Environment Variables

Set up environment-specific configurations:

<Tabs items={['Sandbox', 'Production', 'Multi-Environment']}>
<Tab value="Sandbox">
```bash title=".env.local"
NODE_ENV=development
COMMET_API_KEY=ck_xxx1234567890abcdef
COMMET_ENV=sandbox
```

```typescript title="lib/commet.ts"
import { Commet } from 'commet'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox',
  debug: true
})
```
</Tab>
<Tab value="Production">
```bash title=".env.production"
NODE_ENV=production
COMMET_API_KEY=ck_xxx1234567890abcdef
COMMET_ENV=production
```

```typescript title="lib/commet.ts"
export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'production'
})
```
</Tab>
<Tab value="Multi-Environment">
```typescript title="lib/commet.ts"
const getConfig = () => {
  const env = process.env.NODE_ENV
  
  if (env === 'production') {
    return {
      apiKey: process.env.COMMET_API_KEY!,
      environment: 'production' as const,
      debug: false
    }
  }
  
  return {
    apiKey: process.env.COMMET_API_KEY!,
    environment: 'sandbox' as const,
    debug: true
  }
}

export const commet = new Commet(getConfig())
```
</Tab>
</Tabs>

## Deployment Strategies

### Next.js Deployment

Configure for different deployment environments:

<Tabs items={['Development', 'Preview', 'Production']}>
<Tab value="Development">
```typescript title="lib/commet.ts"
import { Commet } from 'commet'

const isDev = process.env.NODE_ENV === 'development'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox',
  debug: isDev
})
```
</Tab>
<Tab value="Preview">
```typescript title="lib/commet.ts"
// For Vercel Preview deployments
const isPreview = process.env.VERCEL_ENV === 'preview'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: isPreview ? 'sandbox' : 'production',
  debug: isPreview
})
```
</Tab>
<Tab value="Production">
```typescript title="lib/commet.ts"
// Production-ready configuration
export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'production',
  timeout: 30000,
  retries: 3
})
```
</Tab>
</Tabs>

## Environment-Specific Behavior

### Sandbox Environment

Safe testing environment with real API calls to sandbox server:

```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox'
})

// Makes real API requests to sandbox.commet.co
const result = await commet.usage.events.create({
  eventType: 'api_call',
  customerId: 'cus_sandbox_123'
})

console.log('Event created in sandbox:', result.data.id)
```

### Production Environment

Live billing environment with real API calls to production server:

```typescript
const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'production'
})

// Makes real API requests to billing.commet.co
const result = await commet.usage.events.create({
  eventType: 'api_call',
  customerId: 'cus_prod_456'
})

console.log('Event created in production:', result.data.id)
```

## Testing Across Environments

### Environment Testing

Test your environment configuration:

```typescript
const testEnvironment = () => {
  const commet = new Commet({
    apiKey: process.env.COMMET_API_KEY!,
    debug: true
  })
  
  console.log('Environment:', commet.getEnvironment())
  console.log('Is Sandbox:', commet.isSandbox())
  console.log('Is Production:', commet.isProduction())
  console.log('NODE_ENV:', process.env.NODE_ENV)
  
  return {
    environment: commet.getEnvironment(),
    nodeEnv: process.env.NODE_ENV
  }
}

// Run in different environments
console.log(testEnvironment())
```

## Best Practices

### Environment Separation

Keep environments completely separate:

```typescript
// ✅ Environment-specific configuration
const getCommetClient = () => {
  const env = process.env.NODE_ENV
  
  if (env === 'production') {
    return new Commet({
      apiKey: process.env.COMMET_API_KEY!,
      environment: 'production',
      timeout: 30000
    })
  }
  
  return new Commet({
    apiKey: process.env.COMMET_API_KEY!,
    environment: 'sandbox',
    debug: true
  })
}
```

### Configuration Validation

Validate configuration at startup:

```typescript
const validateConfig = () => {
  const requiredEnvVars = ['NODE_ENV', 'COMMET_API_KEY']
  
  for (const envVar of requiredEnvVars) {
    if (!process.env[envVar]) {
      throw new Error(`Missing required environment variable: ${envVar}`)
    }
  }
  
  const apiKey = process.env.COMMET_API_KEY!
  const isProduction = process.env.NODE_ENV === 'production'
  
  if (!apiKey.startsWith('ck_')) {
    console.warn('WARNING: Invalid API key format')
  }
}

// Run validation before initializing SDK
validateConfig()
export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!
})
```

### Deployment Checklist

Before deploying to production:

- [ ] Set `NODE_ENV=production`
- [ ] Set `environment: 'production'` explicitly
- [ ] Use production API key
- [ ] Disable debug logging
- [ ] Configure appropriate timeouts and retries
- [ ] Validate all environment variables are set

```bash title="pre-deployment-check.sh"
#!/bin/bash

echo "Pre-deployment checklist..."

# Check NODE_ENV
if [ "$NODE_ENV" != "production" ]; then
  echo "❌ NODE_ENV is not set to production"
  exit 1
fi

# Check API key format
if [[ ! $COMMET_API_KEY =~ ^ck_ ]]; then
  echo "❌ COMMET_API_KEY should start with ck_"
  exit 1
fi

# Check required variables
for var in NODE_ENV COMMET_API_KEY; do
  if [ -z "${!var}" ]; then
    echo "❌ Missing required environment variable: $var"
    exit 1
  fi
done

echo "✅ Environment configuration validated"
```